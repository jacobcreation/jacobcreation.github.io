<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>City Life Sandbox Simulator</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<style>
  body { background:#87ceeb; color:#000; font-family:sans-serif; text-align:center; transition:background 1s,color 1s; }
  #toolbar { display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin:10px auto; }
  #world { display:grid; grid-template-columns:repeat(20,28px); grid-template-rows:repeat(20,28px); margin:16px auto; width:fit-content; transition:transform 0.8s; }
  .cell { width:28px; height:28px; border:1px solid #222; border-radius:6px; text-align:center; font-size:18px; line-height:28px; user-select:none; }
  .road { background:#555; }
  .traffic { background:#333; color:#fff; }
  .drone { transform: rotateX(60deg) rotateZ(45deg) scale(var(--zoom,1.2)); transform-style:preserve-3d; }
  #topbar { display:flex; gap:8px; justify-content:center; align-items:center; margin:10px auto; }
</style>
</head>
<body>
<h1>ğŸŒ City Life Sandbox Simulator</h1>

<div id="toolbar">
  <button onclick="setTool('road')">ğŸ›£ï¸ Road</button>
  <button onclick="setTool('house')">ğŸ  House</button>
  <button onclick="setTool('person')">ğŸ‘¤ Person</button>
  <button onclick="setTool('car')">ğŸš— Car</button>
  <button onclick="setTool('traffic')">ğŸš¦ Traffic Light</button>
  <button onclick="setTool('bench')">ğŸª‘ Bench</button>
</div>

<div id="topbar">
  <button onclick="window.location.href='https://jacobcreation.github.io/'">ğŸ  Back to Home</button>
  <button id="hoverBtn" onclick="toggleHover()">ğŸ›¸ Hover Mode</button>
  <button onclick="toggleDrone()">ğŸš Drone View</button>
  <button onclick="zoomIn()">â• Zoom In</button>
  <button onclick="zoomOut()">â– Zoom Out</button>
</div>

<div id="world"></div>

<script>
const world=document.getElementById('world');
const size=20;
const cells=[];
let tool='road';
let drone=false;
let zoomLevel=1.2;
let hoverMode=false;

function idx(x,y){return y*size+x;}
function setTool(t){tool=t;}
function toggleDrone(){ drone=!drone; if(drone){ world.classList.add("drone"); } else { world.classList.remove("drone"); } }
function zoomIn(){ if(drone){ zoomLevel+=0.2; world.style.setProperty('--zoom',zoomLevel); } }
function zoomOut(){ if(drone && zoomLevel>0.4){ zoomLevel-=0.2; world.style.setProperty('--zoom',zoomLevel); } }
function toggleHover(){ hoverMode=!hoverMode; document.getElementById("hoverBtn").textContent = hoverMode ? "ğŸ›¸ Hover ON" : "ğŸ›¸ Hover Mode"; }

// Build grid
for(let i=0;i<size*size;i++){
  const cell=document.createElement('div');
  cell.className='cell';
  cell.addEventListener('click',()=>place(cell));
  cell.addEventListener('mouseover',()=>{ if(hoverMode) place(cell); });
  world.appendChild(cell);
  cells.push(cell);
}

function place(cell){
  cell.className='cell '+tool;
  if(tool==='road'){ cell.textContent='ğŸ›£ï¸'; }
  if(tool==='house'){ cell.textContent='ğŸ '; }
  if(tool==='person'){ cell.textContent='ğŸ‘¤'; cell.dataset.walkTimer='0'; }
  if(tool==='car'){ cell.textContent='ğŸš—'; cell.dataset.driver='0'; }
  if(tool==='traffic'){ cell.textContent='ğŸŸ¢'; cell.dataset.state='green'; }
  if(tool==='bench'){ cell.textContent='ğŸª‘'; }
}

function neighbors4(x,y){ return [[0,-1],[0,1],[-1,0],[1,0]].map(([dx,dy])=>[x+dx,y+dy]).filter(([nx,ny])=>nx>=0&&nx<size&&ny>=0&&ny<size); }
function randomDir(){ const d=[[0,-1],[0,1],[-1,0],[1,0]]; return d[Math.floor(Math.random()*d.length)]; }

// Traffic light cycle
function cycleTraffic(){
  for(const c of cells){
    if(c.classList.contains('traffic')){
      let state=c.dataset.state||'green';
      if(state==='green'){ c.dataset.state='yellow'; c.textContent='ğŸŸ¡'; }
      else if(state==='yellow'){ c.dataset.state='red'; c.textContent='ğŸ”´'; }
      else { c.dataset.state='green'; c.textContent='ğŸŸ¢'; }
    }
  }
}
setInterval(cycleTraffic,2000);

// Simulation loop
function step(){
  for(let y=size-1;y>=0;y--){
    for(let x=0;x<size;x++){
      const i=idx(x,y);
      const cell=cells[i];
      const type=cell.classList[1];
      if(!type) continue;

      // Person behavior
      if(type==='person'){
        // increment walk timer
        cell.dataset.walkTimer = String(Number(cell.dataset.walkTimer||'0')+1);

        // if walked for ~10s (50 ticks at 200ms), look for bench
        if(Number(cell.dataset.walkTimer)>=50){
          for(const [nx,ny] of neighbors4(x,y)){
            const bench=cells[idx(nx,ny)];
            if(bench.classList.contains('bench')){
              cell.textContent='ğŸ“±'; // sitting, watching phone
              cell.dataset.restTimer='20'; // rest for 20 ticks
              cell.dataset.walkTimer='0'; // reset walk timer
            }
          }
        }

        // if resting
        if(cell.textContent==='ğŸ“±'){
          cell.dataset.restTimer = String(Number(cell.dataset.restTimer)-1);
          if(Number(cell.dataset.restTimer)<=0){
            cell.textContent='ğŸ‘¤'; // stand up again
          }
        } else {
          // wander
          const [dx,dy]=randomDir();
          const nx=x+dx, ny=y+dy;
          if(nx>=0&&nx<size&&ny>=0&&ny<size){
            const next=cells[idx(nx,ny)];
            if(!next.classList[1] || next.classList.contains('road')){
              next.className='cell person';
              next.textContent='ğŸ‘¤';
              next.dataset.walkTimer=cell.dataset.walkTimer;
              cell.className='cell';
              cell.textContent='';
            }
          }
        }
      }

      // Car behavior
      if(type==='car'){
        if(cell.dataset.driver==='1'){
          const [dx,dy]=randomDir();
          const nx=x+dx, ny=y+dy;
          if(nx>=0&&nx<size&&ny>=0&&ny<size){
            const next=cells[idx(nx,ny)];
            if(next.classList.contains('road')){
              next.className='cell car';
              next.textContent='ğŸš—';
              next.dataset.driver='1';
              cell.className='cell road';
              cell.textContent='ğŸ›£ï¸';
            }
            else if(next.classList.contains('traffic')){
              const state=next.dataset.state;
              if(state==='green'){
                next.className='cell car';
                next.textContent='ğŸš—';
                next.dataset.driver='1';
                cell.className='cell road';
                cell.textContent='ğŸ›£ï¸';
              } else {
                cell.textContent='ğŸš—'; // stop at red/yellow
              }
            }
          }
        } else {
          cell.textContent='ğŸš—'; // parked car
        }
      }
    }
  }
}
setInterval(step,200); // faster ticks so walking is visible
</script>
</body>
</html>
