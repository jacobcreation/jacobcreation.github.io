<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>City Life Sandbox Simulator</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<style>
  body { background:#87ceeb; color:#000; font-family:sans-serif; text-align:center; transition:background 1s,color 1s; }
  #toolbar { display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin:10px auto; }
  #world { display:grid; grid-template-columns:repeat(20,28px); grid-template-rows:repeat(20,28px); margin:16px auto; width:fit-content; transition:transform 0.8s; }
  .cell { width:28px; height:28px; border:1px solid #222; border-radius:6px; text-align:center; font-size:18px; line-height:28px; user-select:none; }
  .road { background:#555; }
  .traffic { background:#333; color:#fff; }
  /* Drone view tilt */
  .drone { transform: rotateX(60deg) rotateZ(45deg) scale(var(--zoom,1.2)); transform-style:preserve-3d; }
</style>
</head>
<body>
<h1>ğŸŒ City Life Sandbox Simulator</h1>

<div id="toolbar">
  <button onclick="setTool('road')">ğŸ›£ï¸ Road</button>
  <button onclick="setTool('house')">ğŸ  House</button>
  <button onclick="setTool('person')">ğŸ‘¤ Person</button>
  <button onclick="setTool('car')">ğŸš— Car</button>
  <button onclick="setTool('traffic')">ğŸš¦ Traffic Light</button>
</div>

<div id="topbar">
  <button onclick="window.location.href='https://jacobcreation.github.io/'">ğŸ  Back to Home</button>
  <button id="hoverBtn" onclick="toggleHover()">ğŸ›¸ Hover Mode</button>
  <button onclick="toggleDrone()">ğŸš Drone View</button>
  <button onclick="zoomIn()">â• Zoom In</button>
  <button onclick="zoomOut()">â– Zoom Out</button>
</div>

<div id="world"></div>

<script>
const world=document.getElementById('world');
const size=20;
const cells=[];
let tool='road';
let drone=false;
let zoomLevel=1.2;
let hoverMode=false;

function idx(x,y){return y*size+x;}
function setTool(t){tool=t;}
function toggleDrone(){
  drone=!drone;
  if(drone){ world.classList.add("drone"); }
  else { world.classList.remove("drone"); }
}
function zoomIn(){
  if(drone){ zoomLevel+=0.2; world.style.setProperty('--zoom',zoomLevel); }
}
function zoomOut(){
  if(drone && zoomLevel>0.4){ zoomLevel-=0.2; world.style.setProperty('--zoom',zoomLevel); }
}
function toggleHover(){
  hoverMode=!hoverMode;
  document.getElementById("hoverBtn").textContent = hoverMode ? "ğŸ›¸ Hover ON" : "ğŸ›¸ Hover Mode";
}

// Build grid
for(let i=0;i<size*size;i++){
  const cell=document.createElement('div');
  cell.className='cell';
  cell.addEventListener('click',()=>place(cell));
  cell.addEventListener('mouseover',()=>{ if(hoverMode) place(cell); });
  world.appendChild(cell);
  cells.push(cell);
}

function place(cell){
  cell.className='cell '+tool;
  if(tool==='road') cell.textContent='ğŸ›£ï¸';
  if(tool==='house') cell.textContent='ğŸ ';
  if(tool==='person'){ cell.textContent='ğŸ‘¤'; cell.dataset.age='20'; }
  if(tool==='car'){ cell.textContent='ğŸš—'; cell.dataset.driver='0'; }
  if(tool==='traffic'){ cell.textContent='ğŸŸ¢'; cell.dataset.state='green'; }
}

// Traffic light cycle
function cycleTraffic(){
  for(const c of cells){
    if(c.classList.contains('traffic')){
      let state=c.dataset.state||'green';
      if(state==='green'){ c.dataset.state='yellow'; c.textContent='ğŸŸ¡'; }
      else if(state==='yellow'){ c.dataset.state='red'; c.textContent='ğŸ”´'; }
      else { c.dataset.state='green'; c.textContent='ğŸŸ¢'; }
    }
  }
}
setInterval(cycleTraffic,2000);

// Simulation loop
function step(){
  for(let y=size-1;y>=0;y--){
    for(let x=0;x<size;x++){
      const i=idx(x,y);
      const cell=cells[i];
      const type=cell.classList[1];
      if(!type) continue;

      // Person can enter car
      if(type==='person'){
        const dirs=[[0,-1],[0,1],[-1,0],[1,0]];
        const [dx,dy]=dirs[Math.floor(Math.random()*4)];
        const nx=x+dx, ny=y+dy;
        if(nx>=0&&nx<size&&ny>=0&&ny<size){
          const neighbor=cells[idx(nx,ny)];
          if(neighbor.classList.contains('car') && neighbor.dataset.driver==='0'){
            neighbor.dataset.driver='1';
            neighbor.textContent='ğŸš—';
            cell.className='cell';
            cell.textContent='';
          }
        }
      }

      // Car moves only if driver inside, only on roads, obey traffic lights
      if(type==='car'){
        if(cell.dataset.driver==='1'){
          const dirs=[[0,-1],[0,1],[-1,0],[1,0]];
          const [dx,dy]=dirs[Math.floor(Math.random()*4)];
          const nx=x+dx, ny=y+dy;
          if(nx>=0&&nx<size&&ny>=0&&ny<size){
            const next=cells[idx(nx,ny)];
            if(next.classList.contains('road')){
              next.className='cell car';
              next.textContent='ğŸš—';
              next.dataset.driver='1';
              cell.className='cell road';
              cell.textContent='ğŸ›£ï¸';
            }
            else if(next.classList.contains('traffic')){
              const state=next.dataset.state;
              if(state==='green'){
                next.className='cell car';
                next.textContent='ğŸš—';
                next.dataset.driver='1';
                cell.className='cell road';
                cell.textContent='ğŸ›£ï¸';
              } else {
                cell.textContent='ğŸš—'; // stop at red/yellow
              }
            }
          }
        } else {
          cell.textContent='ğŸš—'; // parked car
        }
      }
    }
  }
}
setInterval(step,500);
</script>
</body>
</html>
