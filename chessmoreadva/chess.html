<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chess vs Stockfish</title>

<link rel="stylesheet"
 href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/css/chessboard.css">

<style>
body {
  background:#121212;
  color:white;
  font-family:Arial;
  display:flex;
  justify-content:center;
  padding-top:30px;
}

.container {
  display:flex;
  gap:30px;
}

#board {
  width:400px;
}

.controls {
  width:250px;
}
</style>
</head>

<body>

<div class="container">
  <div id="board"></div>

  <div class="controls">
    <h2>Stockfish</h2>

    <label>
      Rating: <span id="ratingValue">1200</span>
      <input type="range" id="rating" min="800" max="2800" step="100" value="1200">
    </label>

    <label>
      Thinking Time (ms): <span id="timeValue">1000</span>
      <input type="range" id="time" min="100" max="3000" step="100" value="1000">
    </label>

    <button id="reset">Reset</button>
  </div>
</div>

<!-- âœ… WORKING LIBRARIES -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chess.js@0.13.4/chess.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/js/chessboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stockfish@16.0.0/stockfish.js"></script>

<script>
let game = new Chess();

let board = Chessboard("board", {
  draggable: true,
  position: "start",
  onDrop: onDrop
});

let engine = Stockfish();
engine.postMessage("uci");

const rating = document.getElementById("rating");
const time = document.getElementById("time");
const rv = document.getElementById("ratingValue");
const tv = document.getElementById("timeValue");

rv.textContent = rating.value;
tv.textContent = time.value;

rating.oninput = () => rv.textContent = rating.value;
time.oninput = () => tv.textContent = time.value;

function onDrop(src, dst) {
  const move = game.move({ from: src, to: dst, promotion: "q" });
  if (!move) return "snapback";
  setTimeout(engineMove, 200);
}

function engineMove() {
  engine.postMessage("setoption name UCI_LimitStrength value true");
  engine.postMessage("setoption name UCI_Elo value " + rating.value);
  engine.postMessage("position fen " + game.fen());
  engine.postMessage("go movetime " + time.value);
}

engine.onmessage = e => {
  if (e.data.startsWith("bestmove")) {
    const m = e.data.split(" ")[1];
    game.move({
      from: m.substring(0,2),
      to: m.substring(2,4),
      promotion: "q"
    });
    board.position(game.fen());
  }
};

document.getElementById("reset").onclick = () => {
  game.reset();
  board.start();
};
</script>

</body>
</html>
