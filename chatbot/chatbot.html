<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PoliteBot Chat</title>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 20px;
    transition: background 0.3s, color 0.3s;
    background: #f0f0f5;
    color: #000;
  }
  body.dark { background: #121212; color: #f0f0f0; }
  #container {
    width: 500px;
    height: 600px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 12px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: background 0.3s, color 0.3s;
  }
  body.dark #container { background: #1e1e1e; }
  #chatBox {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 15px;
    white-space: pre-wrap;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  #typingIndicator {
    padding: 8px;
    font-size: 14px;
    color: gray;
    display: none;
    margin-left: 10px;
    font-style: italic;
  }
  .message {
    display: flex;
    align-items: flex-end;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeIn 0.3s forwards;
  }
  @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
  .message.you { justify-content: flex-end; }
  .bubble {
    max-width: 70%;
    padding: 8px 12px;
    border-radius: 15px;
    font-size: 15px;
    line-height: 1.3;
  }
  .you .bubble {
    background: #1a4bbb;
    color: white;
    border-bottom-right-radius: 0;
  }
  .bot .bubble {
    background: #0b7a00;
    color: white;
    border-bottom-left-radius: 0;
  }
  .bounce { animation: bounce 0.5s; }
  @keyframes bounce { 0% { transform: translateY(0);} 50% { transform: translateY(-10px);} 100% { transform: translateY(0);} }
  #bottom {
    padding: 10px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    background: #f4f4f6;
  }
  body.dark #bottom { background: #2c2c2c; }
  #inputBox { flex: 1; padding: 6px; font-size: 15px; }
  #sendButton, #darkToggle, #clearButton, #forgetButton, #upgradeButton {
    width: 110px;
    font-size: 15px;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="container">
  <div id="chatBox"></div>
  <div id="typingIndicator">PoliteBot is typingâ€¦</div>
  <div id="bottom">
    <input id="inputBox" type="text" placeholder="Type a message...">
    <button id="sendButton">Send</button>
    <button id="darkToggle">ğŸŒ™</button>
    <button id="clearButton">Clear</button>
    <button id="forgetButton">Forget</button>
    <button id="upgradeButton">Needs Upgrades</button>
  </div>
</div>

<script>
let memory = JSON.parse(localStorage.getItem('politebotMemory') || '[]');

const funFacts = [
  "Octopuses have three hearts.",
  "A group of flamingos is called a 'flamboyance'.",
  "Wombat poop is cube-shaped.",
  "A cloud can weigh more than a million pounds.",
  "Bananas are berries, but strawberries are not."
];

const memeReactions = [
  "Bro is COOKING ğŸ”¥ğŸ”¥ğŸ”¥",
  "No cap thatâ€™s actually wild ğŸ˜­",
  "Skibidi facts fr ğŸ¤",
  "Bro got that W rizz ğŸ˜",
  "Ohio behavior ğŸ’€ (jk lol)",
  "Sigma move tbh ğŸ˜ˆ",
  "NPC moment ğŸ’€",
  "Fanum tax took that one fr ğŸ˜­",
  "Goofy ahh energy detected ğŸ˜­ğŸ‘",
  "GYATTT ğŸ˜‚",
  "Bro dropped a whole meme bomb ğŸ’£ğŸ˜‚",
  "Real Gigachad energy ğŸ’ªğŸ˜¤"
];

const knowledge = {
    "capital of france": "Paris ğŸ‡«ğŸ‡·",
    "largest planet": "Jupiter ğŸª",
    "fastest land animal": "Cheetah ğŸ†",
    "hello": "Hi there! ğŸ˜„"
};

function maybeFact() { return Math.random() < 0.25 ? funFacts[Math.floor(Math.random()*funFacts.length)] : null; }

function safeMathEvaluate(expr){
  if(!/^[0-9+\-*/^().\s]+$/.test(expr)) return null;
  let safeExpr = expr.replace(/\^/g,'**');
  try { let result = Function('"use strict"; return ('+safeExpr+')')(); return (typeof result==="number" && isFinite(result))? result: null; }
  catch{ return null; }
}

function speak(text){ let msg = new SpeechSynthesisUtterance(text); window.speechSynthesis.speak(msg); }

function chatLogic(userInput){
  let trimmed = userInput.trim();
  let response="", emotion="ğŸ˜„";

  // meme detection
  const memeWords = ["skibidi","rizz","sigma","ohio","fanum","npc","goofy","gyatt","cap","no cap","bro","goofy ahh"];
  for(let w of memeWords){ if(trimmed.toLowerCase().includes(w)){ return {response: memeReactions[Math.floor(Math.random()*memeReactions.length)], emotion:"ğŸ”¥"}; } }

  // math
  const mathResult = safeMathEvaluate(trimmed);
  if(mathResult!==null) return {response:`The answer is **${mathResult}** ğŸ§ `, emotion:"ğŸ˜"};

  // exit
  if(/^(exit|quit|bye)$/i.test(trimmed)) return {response:"Aight bye bestie ğŸ‘‹ğŸ˜„", emotion:"ğŸ˜Š"};

  // remember
  if(trimmed.toLowerCase().startsWith("remember that")){
    let fact = trimmed.substring(13).trim();
    memory.push(new Date().toISOString().slice(0,10)+": "+fact);
    localStorage.setItem('politebotMemory', JSON.stringify(memory));
    return {response:"Bet, Iâ€™ll remember that ğŸ˜", emotion:"ğŸ˜„"};
  }

  // user name
  let namePattern = /\b(?:my name is|i['â€™]?m|im|call me)\s+([A-Z][a-z]+)\b/i;
  let nameMatch = trimmed.match(namePattern);
  if(nameMatch){
    let name = nameMatch[1];
    memory.push(`${new Date().toISOString().slice(0,10)}: User's name is ${name}`);
    localStorage.setItem('politebotMemory', JSON.stringify(memory));
    return {response:`Yo ${name}! W name ğŸ˜„ğŸ”¥`, emotion:"ğŸ˜„"};
  }

  // feelings
  let feelPattern = /\b(i feel|feeling|feels|i['â€™]?m feeling|im feeling|i am)\s+(.+)/i;
  let feelMatch = trimmed.match(feelPattern);
  if(feelMatch){
    let feeling = feelMatch[2];
    memory.push(`${new Date().toISOString().slice(0,10)}: User felt ${feeling}`);
    localStorage.setItem('politebotMemory', JSON.stringify(memory));
    return {response:`Gotchu, you feelinâ€™ ${feeling}? Valid tbh ğŸ˜„`, emotion:"ğŸ˜Š"};
  }

  // tiny
  if(trimmed.length<3) return {response:"Bro typed the smallest message ever ğŸ˜­ whatâ€™s up?", emotion:"ğŸ˜„"};

  // commands
  if(trimmed==="/help") return {response:"Commands:\n/help\n/fact\n/joke\n/meme\n/dice\n/coin\n/memory\n/time", emotion:"ğŸ˜„"};
  if(trimmed==="/fact") return {response:funFacts[Math.floor(Math.random()*funFacts.length)], emotion:"ğŸ¤“"};
  if(trimmed==="/joke"){
    let jokes=[
      "Why donâ€™t skeletons fight? They donâ€™t have the guts! ğŸ˜‚",
      "What has ears but canâ€™t hear? A cornfield! ğŸŒ½",
      "Why was the math book sad? Too many problems ğŸ˜„"
    ];
    return {response:jokes[Math.floor(Math.random()*jokes.length)], emotion:"ğŸ˜‚"};
  }
  if(trimmed==="/meme") return {response:memeReactions[Math.floor(Math.random()*memeReactions.length)], emotion:"ğŸ”¥"};
  if(trimmed==="/dice"){ let roll = Math.floor(Math.random()*6)+1; return {response:`You rolled a ${roll} ğŸ²`, emotion:"ğŸ˜"}; }
  if(trimmed==="/coin"){ let flip = Math.random()<0.5?"Heads":"Tails"; return {response:`Coin flipped: ${flip} ğŸª™`, emotion:"ğŸ˜"}; }
  if(trimmed==="/memory"){ return {response: memory.length? memory.join("\n"):"Nothing remembered yet ğŸ˜…", emotion:"ğŸ§ "}; }
  if(trimmed==="/time"){ return {response: `Current time: ${new Date().toLocaleTimeString()}`, emotion:"â°"}; }

  // knowledge-based answers
  for(let q in knowledge){ if(trimmed.toLowerCase().includes(q)){ return {response: knowledge[q], emotion:"ğŸ˜"}; } }

  // greetings
  if(/^(hi|hello|hey|yo|sup)/i.test(trimmed)){
    return {response:["Yo! ğŸ˜","Hey bestie ğŸ‘‹","Wassup ğŸ˜„","Hiiiii ğŸ˜"][Math.floor(Math.random()*4)], emotion:"ğŸ˜Š"};
  }

  // question
  if(trimmed.endsWith("?")) return {response:"Good question ngl ğŸ¤” what do *you* think?", emotion:"ğŸ¤”"};

  // generic friend vibes
  let generic = [
    "Real talk? Thatâ€™s kinda fire ğŸ”¥",
    "Valid take tbh ğŸ˜„",
    "Bro I feel that ğŸ˜­",
    "Interesting, tell me more ğŸ‘€",
    "Okay thatâ€™s lowkey cool ğŸ˜",
    "Not gonna lie thatâ€™s a W ğŸ‘"
  ];
  response = generic[Math.floor(Math.random()*generic.length)];
  let fact = maybeFact(); if(fact) response += " Also fun fact: " + fact;
  return {response, emotion};
}

// UI without sounds
const chatBox = document.getElementById("chatBox");
const typingIndicator = document.getElementById("typingIndicator");
const inputBox = document.getElementById("inputBox");
const sendButton = document.getElementById("sendButton");
const darkToggle = document.getElementById("darkToggle");
const clearButton = document.getElementById("clearButton");
const forgetButton = document.getElementById("forgetButton");
const upgradeButton = document.getElementById("upgradeButton");

function appendMessage(who,msg,emotion="ğŸ˜„"){
  let div = document.createElement("div");
  div.classList.add("message",who);
  let bubble = document.createElement("div");
  bubble.classList.add("bubble");
  bubble.innerHTML = who==="bot"? msg + " " + emotion : msg;
  if(who==="bot") bubble.classList.add("bounce");
  div.appendChild(bubble);
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
  // Removed sound play calls
  // if(who==="you") sendSound.play();
  // else receiveSound.play();
  if(who==="bot") speak(msg);
}

function showTyping(){ typingIndicator.style.display="block"; }
function hideTyping(){ typingIndicator.style.display="none"; }

function botRespondSlowly(text, emotion){
  showTyping();
  setTimeout(()=>{ hideTyping(); appendMessage("bot",text,emotion); },400+Math.random()*600);
}

// Events
sendButton.onclick = ()=>{ 
  let text = inputBox.value.trim(); 
  if(text==="") return; 
  appendMessage("you",text); 
  let {response, emotion} = chatLogic(text); 
  botRespondSlowly(response, emotion); 
  inputBox.value=""; 
};

inputBox.addEventListener("keydown",e=>{ if(e.key==="Enter"){ e.preventDefault(); sendButton.click(); } });
darkToggle.onclick = ()=> document.body.classList.toggle("dark");
clearButton.onclick = ()=>{ chatBox.innerHTML=""; botRespondSlowly("Chat cleared ğŸ‘ memories safe.","ğŸ˜„"); };
forgetButton.onclick = ()=>{ chatBox.innerHTML=""; memory=[]; localStorage.removeItem('politebotMemory'); botRespondSlowly("Aight I forgot everything ğŸ˜„ start fresh!", "ğŸ˜„"); };

// Upgrade button
upgradeButton.onclick = ()=>{ botRespondSlowly("Please send messages to jacobcreation on GitHub! ğŸ˜„", "ğŸ“¢"); };

appendMessage("bot","Yo! Iâ€™m PoliteBot ğŸ˜ Drop a meme, math problem, or try /help!", "ğŸ˜„");
</script>
</body>
</html>
